<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Locked Floating Iframe</title>
<style>
  #iframeContainer {
    position: fixed;
    top: 50px;
    left: 50px;
    width: 600px;
    height: 400px;
    background: #fff;
    border: 2px solid #444;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 9999;
    overflow: hidden;
    display: none;
  }

  #iframeHeader {
    position: relative;
    background: #444;
    color: white;
    padding: 8px 12px;
    font-weight: bold;
    cursor: move;
    user-select: none;
  }

  #closeBtn {
    position: absolute;
    right: 10px;
    top: 6px;
    cursor: pointer;
    font-size: 18px;
    color: white;
    font-weight: bold;
    transition: color 0.2s;
  }
  #closeBtn:hover {
    color: #ff5555;
  }

  #floatingIframe {
    width: 100%;
    height: calc(100% - 32px);
    border: none;
  }

  /* Resize handles */
  .resize-handle {
    position: absolute;
    background: transparent;
    z-index: 10000;
  }
  .resize-handle.n { top: -4px; left: 0; width: 100%; height: 8px; cursor: n-resize; }
  .resize-handle.s { bottom: -4px; left: 0; width: 100%; height: 8px; cursor: s-resize; }
  .resize-handle.e { top: 0; right: -4px; width: 8px; height: 100%; cursor: e-resize; }
  .resize-handle.w { top: 0; left: -4px; width: 8px; height: 100%; cursor: w-resize; }
  .resize-handle.nw { top: -4px; left: -4px; width: 10px; height: 10px; cursor: nw-resize; }
  .resize-handle.ne { top: -4px; right: -4px; width: 10px; height: 10px; cursor: ne-resize; }
  .resize-handle.sw { bottom: -4px; left: -4px; width: 10px; height: 10px; cursor: sw-resize; }
  .resize-handle.se { bottom: -4px; right: -4px; width: 10px; height: 10px; cursor: se-resize; }
</style>
</head>
<body>

<button onclick="openFloatingIframe('https://example.com')">Open Iframe</button>

<div id="iframeContainer">
  <div id="iframeHeader">
    Floating Iframe
    <span id="closeBtn" onclick="closeIframe()">âœ•</span>
  </div>
  <iframe id="floatingIframe"></iframe>

  <!-- Resize handles -->
  <div class="resize-handle n"></div>
  <div class="resize-handle s"></div>
  <div class="resize-handle e"></div>
  <div class="resize-handle w"></div>
  <div class="resize-handle nw"></div>
  <div class="resize-handle ne"></div>
  <div class="resize-handle sw"></div>
  <div class="resize-handle se"></div>
</div>

<script>
function openFloatingIframe(url) {
  const container = document.getElementById('iframeContainer');
  const iframe = document.getElementById('floatingIframe');
  iframe.src = url;
  container.style.display = 'block';
}

function closeIframe() {
  const container = document.getElementById('iframeContainer');
  const iframe = document.getElementById('floatingIframe');
  iframe.src = '';
  container.style.display = 'none';
}

// --- Dragging logic with window lock ---
(function() {
  const container = document.getElementById('iframeContainer');
  const header = document.getElementById('iframeHeader');
  let offsetX = 0, offsetY = 0, isDragging = false;

  header.addEventListener('mousedown', function(e) {
    isDragging = true;
    offsetX = e.clientX - container.offsetLeft;
    offsetY = e.clientY - container.offsetTop;
    document.body.style.userSelect = 'none';
  });

  document.addEventListener('mouseup', () => {
    isDragging = false;
    document.body.style.userSelect = '';
  });

  document.addEventListener('mousemove', function(e) {
    if (isDragging) {
      let newLeft = e.clientX - offsetX;
      let newTop = e.clientY - offsetY;

      // Lock within viewport
      const maxLeft = window.innerWidth - container.offsetWidth;
      const maxTop = window.innerHeight - container.offsetHeight;
      newLeft = Math.min(Math.max(0, newLeft), maxLeft);
      newTop = Math.min(Math.max(0, newTop), maxTop);

      container.style.left = newLeft + 'px';
      container.style.top = newTop + 'px';
    }
  });
})();

// --- Resizing logic with viewport lock ---
(function() {
  const container = document.getElementById('iframeContainer');
  let isResizing = false, handle = null, startX, startY, startW, startH, startL, startT;

  document.querySelectorAll('.resize-handle').forEach(h => {
    h.addEventListener('mousedown', e => {
      e.preventDefault();
      isResizing = true;
      handle = h.classList[1];
      startX = e.clientX;
      startY = e.clientY;
      const rect = container.getBoundingClientRect();
      startW = rect.width;
      startH = rect.height;
      startL = rect.left;
      startT = rect.top;
      document.body.style.userSelect = 'none';
    });
  });

  document.addEventListener('mousemove', e => {
    if (!isResizing) return;
    let dx = e.clientX - startX;
    let dy = e.clientY - startY;
    let newWidth = startW;
    let newHeight = startH;
    let newLeft = startL;
    let newTop = startT;

    if (handle.includes('e')) newWidth = startW + dx;
    if (handle.includes('s')) newHeight = startH + dy;
    if (handle.includes('w')) { newWidth = startW - dx; newLeft = startL + dx; }
    if (handle.includes('n')) { newHeight = startH - dy; newTop = startT + dy; }

    // Constrain size
    const minWidth = 200, minHeight = 150;
    newWidth = Math.max(minWidth, newWidth);
    newHeight = Math.max(minHeight, newHeight);

    // Lock inside window bounds
    const maxLeft = window.innerWidth - newWidth;
    const maxTop = window.innerHeight - newHeight;
    newLeft = Math.min(Math.max(0, newLeft), maxLeft);
    newTop = Math.min(Math.max(0, newTop), maxTop);

    // Apply new styles
    container.style.width = newWidth + 'px';
    container.style.height = newHeight + 'px';
    container.style.left = newLeft + 'px';
    container.style.top = newTop + 'px';
  });

  document.addEventListener('mouseup', () => {
    isResizing = false;
    document.body.style.userSelect = '';
  });
})();
</script>

</body>
</html>
